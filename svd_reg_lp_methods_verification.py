import numpy as np

# ---------------------------------------------------------------
# ВХОДНЫЕ ДАННЫЕ (ты подставишь свои)
# ---------------------------------------------------------------
# A: (3000, 39)
# B: (3000, 15000)
# f: (39,) из любого из трех методов (они у тебя совпали)

# A = ...
# B = ...
# f = wA  # или wB или wC

# коробочные ограничения на x (длины 39)
# x_low = ...
# x_high = ...

# ---------------------------------------------------------------
# 1. SVD разложение A
# ---------------------------------------------------------------
U, sigma, Vt = np.linalg.svd(A, full_matrices=False)
V = Vt.T  # удобнее так

# ---------------------------------------------------------------
# 2. Пересчет mu_i (если нужно)
# ---------------------------------------------------------------
mu = np.maximum(0, sigma * (1.0 / f - sigma))

print("mu =", mu)

# ---------------------------------------------------------------
# 3. Вычисляем Uᵀ B
# ---------------------------------------------------------------
Z = U.T @ B  # shape = (39, 15000)

# ---------------------------------------------------------------
# 4. Применяем диагональ diag(f_i)
# ---------------------------------------------------------------
FZ = f[:, None] * Z  # broadcasting → (39, 15000)

# ---------------------------------------------------------------
# 5. Восстанавливаем решения x_lambda
# ---------------------------------------------------------------
X_lambda = V @ FZ  # (39 × 39) @ (39 × 15000) → (39 × 15000)

print("X_lambda shape:", X_lambda.shape)

# ---------------------------------------------------------------
# 6. Проверка box constraints
# ---------------------------------------------------------------
viol_low  = (X_lambda < x_low[:, None]).sum()
viol_high = (X_lambda > x_high[:, None]).sum()
total_viol = viol_low + viol_high

print("Violations below lower bound:", viol_low)
print("Violations above upper bound:", viol_high)
print("TOTAL BOX VIOLATIONS:", total_viol)

# ---------------------------------------------------------------
# 7. Вывод, прошли ли все решения условия
# ---------------------------------------------------------------
if total_viol == 0:
    print("SUCCESS: All 15000 x_lambda satisfy box constraints!")
else:
    print("WARNING: Some x_lambda violate constraints.")
